<%
var colorArr = ['#FF00CC','#FF6666','#FF99CC','#FFFF99','#CCFFFF','#FFCCCC','#FF9966','#FF6699','#99CCCC','#CCFF99','#CCFFCC','#6699CC',
'#66CCFF','#66CCCC'];
var colorCount = colorArr.length;
var hashCode = function (str) {
    if (!str && str.length === 0) {
        return 0;
    }
    var hash = 0;
    for (var i = 0, len = str.length; i < len; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash |= 0;
    }
    return hash;
};
var i = 0;
%>
<%
    i++;
    var color = colorArr[Math.abs(hashCode(page.category) % colorCount)];
%>
<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"></div>
<div class="bg-light-floor-categoryDetail" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -3;"></div>

<div class="lazyload category-header" data-original="<%- url_for(theme.categoryDetail.img) %>">
  <div class="category-header-title">
    <%= theme.categoryDetail.title %>
  </div>
  <div class="category-header-desc">
    <% if (theme.typed.on === true) { %>
      <span class="title" id="category-header-desc"></span>
      <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
          <script>
          var typed = new Typed("#category-header-desc", {
              strings: ['<%= theme.categoryDetail.desc %>'],
              startDelay: <%= theme.typed.startDelay %>,
              typeSpeed: <%= theme.typed.typeSpeed %>,
              loop: true,
              backSpeed: <%= theme.typed.backSpeed %>,
              showCursor: true
          });
          </script>
      <% } else {  %>
          <span class="title">
          <%= theme.categoryDetail.desc %>
          </span>
      <% } %>
  </div>
  <div class="mask-box"></div>
</div>

<div class="category-video">
  <video class="full-video" autoplay loop muted>
      <source style="width: 100%;height: 100vh;" src="<%- url_for(theme.categoryDetail.video) %>">
  </video>
  <div class="video-header-title">
    <%= theme.categoryDetail.title %>
  </div>
  <div class="video-header-desc">
  <% if (theme.typed.on === true) { %>
      <span class="title" id="video-header-desc"></span>
      <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
          <script>
          var typed = new Typed("#video-header-desc", {
              strings: ['<%= theme.categoryDetail.desc %>'],
              startDelay: <%= theme.typed.startDelay %>,
              typeSpeed: <%= theme.typed.typeSpeed %>,
              loop: true,
              backSpeed: <%= theme.typed.backSpeed %>,
              showCursor: true
          });
          </script>
      <% } else {  %>
          <span class="title">
          <%= theme.categoryDetail.desc %>
          </span>
      <% } %>
  </div>
  <div class="mask-box"></div>
</div>

<div class="category">
  <div class="category-name">
    <div class="name" style="background-color: <%- color %>;"><%= page.category %> <%= __('category') %></div>
  </div>
  <section class="posts">
    <% page.posts.each(function (post, i) { %>
    <article class="post" data-aos="<%= theme.aos.animate || 'fade-up' %>"
      style="<% if(i % 2 == 0) { %>flex-direction: row-reverse;<% } %>">
      <div class="post-main">
        <div class="post-info">
          <div class="post-time">
            <i class="fa fa-clock-o" aria-hidden="true"></i>
            <span class="post-time"><%- date(post.date, "YYYY-MM-DD") %></span>
          </div>
          <div class="post-title">
            <a class="post-title-link" href="<%- url_for(post.path) %>"><%= post.title %></a>
          </div>
          <div class="post-meta">
            <div class="post-tags">
              <%- partial('_partial/post/tags', {post: post}) %>
            </div>
            <div class="post-categories">
              <%- partial('_partial/post/categories', {post: post}) %>
            </div>
          </div>
          <div class="post-img-mobile">
            <% if (post.img || post.swiperImg) { %>
              <a href="<%- url_for(post.path) %>" class="lazyload" data-original="<%- url_for(post.img || post.swiperImg) %>" style="background-size: cover;
                background-position: center center;">
              </a>
            <% } else { %>
              <%
                var img = 'https://ssyerv1.oss-cn-hangzhou.aliyuncs.com/picture/ada660a8c596431983dddd411a12f2b3.jpg!sswm';
                var imgs = theme.imgs;
                if (!imgs || imgs.length === 0) {
                    return img;
                }
                img = imgs[Math.abs(hashCode(post.title) % imgs.length)]
              %>
              <a href="<%- url_for(post.path) %>" class="lazyload" data-original="<%- url_for(img)%>" style="background-size: cover;
                background-position: center center;">
              </a>
            <% } %>
          </div>
          <div class="post-content">
            <%- post.excerpt || strip_html(post.content).substring(0, 120) %>
          </div>
        </div>
        <div class="post-more">
          <a href="<%- url_for(post.path) %>">
            <i class="iconfont iconmore" style="<% if(i % 2 == 0) { %>float: right;<% } %>" title="阅读更多"></i>
          </a>
        </div>
      </div>
      <div class="post-img">
        <% if (post.img || post.swiperImg) { %>
          <a href="<%- url_for(post.path) %>" class="lazyload" data-original="<%- url_for(post.img || post.swiperImg) %>" style="background-size: cover;
            background-position: center center;">
          </a>
        <% } else { %>
          <a href="<%- url_for(post.path) %>" class="lazyload" data-original="<%- url_for(img) %>" style="background-size: cover;
            background-position: center center;">
          </a>
        <% } %>
      </div>
    </article>
    <% }) %>
  </section>
</div>
<%- partial('_partial/paginator') %>
